<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mapper.ComicMapper">

    <resultMap id="getComics" type="com.entity.Comic">
        <id property="id" column="id"/>
        <result property="comicname" column="comicname"/>
        <result property="author" column="author"/>
        <result property="introduction" column="introduction"/>
        <result property="ccode" column="ccode"/>
        <result property="area" column="area"/>
        <result property="updatetime" column="updatetime"/>
        <result property="photopath" column="photopath"/>
        <result property="score" column="score"/>
        <result property="heat" column="heat"/>
        <collection property="comicLists" ofType="com.entity.ComicList">
            <id property="id" column="clid"/>
            <result property="comictype" column="comictype"/>
        </collection>
    </resultMap>
    <select id="getComics" resultMap="getComics">
/*select * from comic order by updatetime DESC*/
select comic.*,comiclist.id clid,comiclist.comictype from comic,havelist,comiclist WHERE comic.id=havelist.comicid and havelist.comiclistid=comiclist.id  order by comic.updatetime DESC
</select>
    <delete id="deleteComicById" parameterType="int">
 delete  from comic where id=#{id}
</delete>
    <select id="getComicSByOther" parameterType="com.entity.Comic" resultType="com.entity.Comic">
select * from comic
<where>
<if test="comicname!=null and comicname!=''">
comicname=#{comicname}
</if>
<if test="author!=null and author!=''">
and author=#{author}
</if>
<if test="ccode!=null and ccode!=''">
and ccode=#{ccode}
</if>
<if test="area!=null and area!=''">
and area=#{area}
</if>
</where>
order by heat desc
</select>
    <select id="getComicById" parameterType="int" resultType="com.entity.Comic">
select * from comic where id=#{id}
</select>
    <insert id="addComic" parameterType="com.entity.Comic"  useGeneratedKeys ="true"  keyProperty = "id" keyColumn = "id">
insert into comic(comicname,author,introduction,ccode,area,updatetime,photopath,score)
values(#{comicname},#{author},#{introduction},#{ccode},#{area},#{updatetime},#{photopath},#{score})
</insert>
    <insert id="insertComicList" parameterType="com.entity.HaveList">
insert into havelist(comicid,comiclistid) values(#{comicid},#{comiclistid})
</insert>
    <select id="getComicByTypeId" parameterType="int" resultType="com.entity.Comic">
select comic.* from havelist,comic where comic.id=havelist.comicid and havelist.comiclistid=#{comiclistid}
</select>
    <insert id="addChapter" parameterType="com.entity.Chapter">
insert into chapter(comicid,cnumber,cname,ctime,content) values(#{comicid},#{cnumber},#{cname},#{ctime},#{content})
</insert>
    <select id="getChaptersByComicId" parameterType="int" resultType="com.entity.Chapter">
select * from chapter where comicid=#{comicid} order by ctime desc
</select>
    <delete id="deleteChapterById" parameterType="int">
delete from chapter where id=#{id}
</delete>
    <select id="getChapterByNumber"  resultType="com.entity.Chapter">
select * from chapter where cnumber=#{cnumber} and comicid=#{comicid}
</select>
    <update id="updateTime" parameterType="com.entity.Comic">
update comic set updatetime=#{updatetime} where id=#{id}
</update>
<delete id="deleteTypeById" parameterType="int">
    delete from havelist where comicid=#{comicid}
</delete>
    <update id="addHeat" parameterType="int">
update comic set heat=heat+1 where id=#{id}
</update>
    <select id="getComicList" parameterType="int" resultType="com.entity.ComicList">
select comiclist.* from comiclist,havelist where havelist.comicid=#{comicid} and havelist.comiclistid=comiclist.id
</select>
    <select id="getChapter" resultType="com.entity.Chapter">
select * from chapter order by ctime desc
</select>
</mapper>